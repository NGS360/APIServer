{"version":3,"file":"search-bar-C4mhsUwd.js","sources":["../../node_modules/lucide-react/dist/esm/icons/delete.js","../../node_modules/lucide-react/dist/esm/icons/external-link.js","../../src/components/search-bar.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.476.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z\",\n      key: \"1yo7s0\"\n    }\n  ],\n  [\"path\", { d: \"m12 9 6 6\", key: \"anjzzh\" }],\n  [\"path\", { d: \"m18 9-6 6\", key: \"1fp51s\" }]\n];\nconst Delete = createLucideIcon(\"Delete\", __iconNode);\n\nexport { __iconNode, Delete as default };\n//# sourceMappingURL=delete.js.map\n","/**\n * @license lucide-react v0.476.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 3h6v6\", key: \"1q9fwt\" }],\n  [\"path\", { d: \"M10 14 21 3\", key: \"gplh6r\" }],\n  [\"path\", { d: \"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6\", key: \"a6xqqp\" }]\n];\nconst ExternalLink = createLucideIcon(\"ExternalLink\", __iconNode);\n\nexport { __iconNode, ExternalLink as default };\n//# sourceMappingURL=external-link.js.map\n","import { useEffect, useRef, useState } from 'react'\nimport { DeleteIcon, ExternalLink, Search } from 'lucide-react'\nimport { Link, useNavigate } from '@tanstack/react-router'\nimport { useQuery } from '@tanstack/react-query'\nimport { useForm } from 'react-hook-form'\nimport type { FC, ReactNode } from 'react'\nimport type { ProjectPublic, SequencingRunPublic } from '@/client'\nimport { Popover, PopoverAnchor, PopoverContent } from '@/components/ui/popover'\nimport { ScrollArea, ScrollBar } from '@/components/ui/scroll-area'\nimport { Button } from '@/components/ui/button'\nimport { searchOptions } from '@/client/@tanstack/react-query.gen'\nimport { useDebounce } from '@/hooks/use-debounce'\nimport { Separator } from '@/components/ui/separator'\nimport { highlightMatch } from '@/lib/utils'\n\n// Search item component\ninterface SearchItemProps {\n  children: ReactNode\n  onClick?: () => void\n  isHighlighted?: boolean\n}\nconst SearchItem: FC<SearchItemProps> = ({ children, onClick, isHighlighted }) => (\n  <div\n    onClick={onClick}\n    className={`px-2 py-0.5 rounded-md text-sm cursor-pointer ${\n      isHighlighted ? 'bg-muted' : 'hover:bg-muted'\n    }`}\n  >\n    {children}\n  </div>\n)\n\n// Search group component\ninterface SearchGroupProps {\n  children: ReactNode\n  heading?: string\n}\nconst SearchGroup: FC<SearchGroupProps> = ({ children, heading }) => (\n  <>\n    {heading && (\n      <div className=\"flex justify-center\">\n        <h1 className=\"px-2 py-1.5 text-xs text-muted-foreground\">{heading}</h1>\n      </div>\n    )}\n    {children}\n  </>\n)\n\n// Main SearchBar component\ninterface SearchBarProps {\n  onResultClick?: () => void\n}\n\nexport const SearchBar: FC<SearchBarProps> = ({ onResultClick }) => {\n  const navigate = useNavigate();\n\n  // State to control popover\n  const [openResults, setOpenResults] = useState(false);\n\n  // State for keyboard navigation\n  const [selectedIndex, setSelectedIndex] = useState(-1);\n  const selectedItemRef = useRef<HTMLDivElement>(null);\n\n  // Use react-hook-form to watch for search input changes\n  const { register, watch, setValue } = useForm<{ search: string }>();\n  const watchedInput = watch('search', '');\n  const debouncedInput = useDebounce(watchedInput, 300);\n\n  // Function to handle result click: close popover and clear search\n  const handleResultClick = (navigateFn: () => void) => {\n    navigateFn();\n    setValue('search', '');\n    setOpenResults(false);\n    onResultClick?.(); // Call the optional callback\n  };\n\n  // Query using debounced input\n  const { \n    data: { projects, runs } = { projects: [], runs: [] }\n  } = useQuery({\n    ...searchOptions({\n      query: {\n        query: debouncedInput,\n        n_results: 5\n      }\n    }),\n    select: (res) => ({\n      projects: res.projects.data,\n      runs: res.runs.data\n    }),\n    enabled: !!debouncedInput\n  })\n\n  // Trigger popover when debouncedInput changes\n  useEffect(() => {\n    setOpenResults(!!debouncedInput);\n    setSelectedIndex(-1); // Reset selection when search changes\n  }, [debouncedInput]);\n\n  // Build navigable items list\n  const navigableItems = [\n    ...projects.map((p: ProjectPublic) => ({\n      type: 'project' as const,\n      data: p,\n      navigate: () => navigate({\n        to: '/projects/$project_id',\n        params: { project_id: p.project_id }\n      })\n    })),\n    ...runs.map((r: SequencingRunPublic) => ({\n      type: 'run' as const,\n      data: r,\n      navigate: () => navigate({\n        to: '/runs/$run_barcode',\n        params: { run_barcode: r.barcode || \"\" }\n      })\n    }))\n  ];\n\n  // Handle keyboard navigation\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (!openResults || navigableItems.length === 0) return;\n\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setSelectedIndex((prev) => \n          prev < navigableItems.length - 1 ? prev + 1 : prev\n        );\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        setSelectedIndex((prev) => (prev > 0 ? prev - 1 : -1));\n        break;\n      case 'Enter':\n        e.preventDefault();\n        if (selectedIndex >= 0 && selectedIndex < navigableItems.length) {\n          handleResultClick(navigableItems[selectedIndex].navigate);\n        }\n        break;\n      case 'Escape':\n        setOpenResults(false);\n        setSelectedIndex(-1);\n        break;\n    }\n  };\n\n  // Scroll the selected item into view\n  useEffect(() => {\n    if (selectedItemRef.current) {\n      selectedItemRef.current.scrollIntoView({\n        block: 'nearest',\n        behavior: 'smooth'\n      });\n    }\n  }, [selectedIndex]);\n\n  return (\n    <>\n      {/* Search bar */}\n      <div className=\"flex gap-2 items-center pl-3 rounded-md h-9 border-1\">\n        <Search size={16} className=\"text-muted-foreground\" />\n        <input\n          id=\"es-input\"\n          className=\"w-full text-sm focus:outline-none\"\n          placeholder=\"Search for projects or runs...\"\n          {...register('search')}\n          onKeyDown={handleKeyDown}\n        />\n        <Button\n          variant=\"link\"\n          className=\"text-muted-foreground hover:text-foreground\"\n          onClick={() => setValue('search', '')}\n          title=\"Reset search\"\n        >\n          <DeleteIcon />\n        </Button>\n      </div>\n\n      {/* Search results */}\n      <Popover open={openResults}>\n        <PopoverAnchor />\n        <PopoverContent\n          onOpenAutoFocus={(e) => e.preventDefault()}\n          className=\"w-[var(--radix-popper-anchor-width)] p-1\"\n        >\n          <ScrollArea>\n            <div className='max-h-125'>\n              <ScrollBar orientation=\"vertical\" />\n              {projects.length > 0 && (\n                <>\n                  <SearchGroup heading=\"Projects\">\n                    {projects.map((p: ProjectPublic, index: number) => (\n                      <SearchItem\n                        key={p.project_id}\n                        onClick={() => handleResultClick(() => navigate({\n                          to: '/projects/$project_id',\n                          params: { project_id: p.project_id }\n                        }))}\n                        isHighlighted={selectedIndex === index}\n                      >\n                        <div ref={selectedIndex === index ? selectedItemRef : null}>\n                          <span className='text-sm'>\n                            {highlightMatch(p.project_id, debouncedInput)}\n                          </span>\n                          <span className='text-xs text-muted-foreground'> {/* Use line-clamp-1 here to truncate */}\n                            {highlightMatch(p.name || '', debouncedInput)}\n                          </span>\n                        </div>\n                      </SearchItem>\n                    ))}\n                    <SearchItem>\n                      <Link \n                        className=\"flex items-center gap-2 text-primary cursor-pointer\"\n                        to=\"/projects\"\n                        search={{ \n                          query: debouncedInput,\n                          sort_by: 'name',\n                          sort_order: 'asc'\n                        }}\n                      >\n                        <ExternalLink size={14} />\n                        <span>View all projects</span>\n                      </Link>\n                    </SearchItem>\n                  </SearchGroup>\n\n                  {runs.length > 0 && <Separator className=\"my-0.5\" />}\n                </>\n              )}\n\n              {runs.length > 0 && (\n                <SearchGroup heading=\"Runs\">\n                  {runs.map((r: SequencingRunPublic, index: number) => {\n                    const runIndex = projects.length + index;\n                    return (\n                      <SearchItem\n                        key={r.barcode}\n                        onClick={() => handleResultClick(() => navigate({\n                          to: '/runs/$run_barcode',\n                          params: { run_barcode: r.barcode || \"\" }\n                        }))}\n                        isHighlighted={selectedIndex === runIndex}\n                      >\n                        <div ref={selectedIndex === runIndex ? selectedItemRef : null}>\n                          <span className='text-sm'>\n                            {highlightMatch(r.barcode || '', debouncedInput)}\n                          </span>\n                          <span className='text-xs text-muted-foreground'> {/* Use line-clamp-1 here to truncate */}\n                            {highlightMatch(r.experiment_name || '', debouncedInput)}\n                          </span>\n                        </div>\n                      </SearchItem>\n                    );\n                  })}\n                  <SearchItem>\n                    {/* TODO: update to runs page */}\n                    <Link\n                      className=\"flex items-center gap-2 text-primary cursor-pointer\"\n                      to=\"/runs\"\n                      search={{ query: debouncedInput }}\n                    >\n                      <ExternalLink size={14} />\n                      <span>View all runs</span>\n                    </Link>\n                  </SearchItem>\n                </SearchGroup>\n              )}\n\n              {projects.length === 0 && runs.length === 0 && (\n                <div className=\"flex justify-center p-4 text-sm text-muted-foreground\">\n                  No results found.\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n        </PopoverContent>\n      </Popover>\n    </>\n  )\n}\n"],"names":["__iconNode","Delete","createLucideIcon","ExternalLink","SearchItem","children","onClick","isHighlighted","jsx","SearchGroup","heading","jsxs","Fragment","SearchBar","onResultClick","navigate","useNavigate","openResults","setOpenResults","useState","selectedIndex","setSelectedIndex","selectedItemRef","useRef","register","watch","setValue","useForm","watchedInput","debouncedInput","useDebounce","handleResultClick","navigateFn","projects","runs","useQuery","searchOptions","res","useEffect","navigableItems","p","r","handleKeyDown","e","prev","Search","Button","DeleteIcon","Popover","PopoverAnchor","PopoverContent","ScrollArea","ScrollBar","index","highlightMatch","Link","Separator","runIndex"],"mappings":"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","x_google_ignoreList":[0,1]}