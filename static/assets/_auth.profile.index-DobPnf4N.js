import{c as O,r as _,o as Q,a9 as B,j as e,aa as H,ab as Z,ac as G,ad as Y,ae as $,af as W,ag as X,L as ee,ah as se,s as v,e as ae,a as re,ai as te,aj as ne,f as ie,a5 as oe,ak as R,al as V,am as I,a6 as ce}from"./index-BIirldc1.js";import{u as de}from"./useQuery-CTa4JkgR.js";import{u as K}from"./useMutation-DLDY0_Jn.js";import{t as P}from"./index-CbXsuHis.js";import{u as le}from"./use-job-queries-C1A_Ye7H.js";import{S as me,a as N}from"./sortable-header-CBUhMdW4.js";import{C as xe}from"./copyable-text-hzJJx6rD.js";import{J as ue}from"./job-status-badge-ahLloNQM.js";import{C as T,a as M,b as E,d as A,c as D}from"./card-B_B2k0jE.js";import{u as pe}from"./index.esm-DeL_VMPh.js";import{a as he,L as C}from"./label-BoUK3cZg.js";import{B as p}from"./button-C2PM_K_5.js";import{I as S}from"./input-DMyO_KgQ.js";import{S as je}from"./shield-check-DjtTMb8z.js";import{M as ge}from"./mail-DOmqMivu.js";import{R as fe}from"./refresh-cw-6Ar4KVNV.js";import"./useBaseQuery-o_MHl0Bk.js";import"./index-P1ukJAZU.js";import"./scroll-area-BlkD1AVU.js";import"./popover-Daw9D_6H.js";import"./check-DV4XU-UY.js";import"./circle-x-D_RBEnZV.js";import"./circle-play-u-Uw65K8.js";import"./zap-BU4rm8MZ.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],Ne=O("KeyRound",we),be=Q({current_password:v().min(1,"Current password is required"),new_password:v().min(8,"New password must be at least 8 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[0-9]/,"Password must contain at least one number"),confirm_password:v().min(1,"Please confirm your password")}).refine(m=>m.new_password===m.confirm_password,{message:"Passwords don't match",path:["confirm_password"]}),ye=({trigger:m})=>{const[s,h]=_.useState(!1),b=i=>{i||u(),h(i)},{register:c,handleSubmit:x,reset:u,setError:t,formState:{errors:n,isSubmitting:o}}=pe({defaultValues:{current_password:"",new_password:"",confirm_password:""},resolver:he(be)}),{mutate:y,isPending:l}=K({...B(),onError:i=>{var g,f;const j=((f=(g=i.response)==null?void 0:g.data.detail)==null?void 0:f.toString())||"An unknown error occurred.";t("root",{message:j})},onSuccess:()=>{u(),P.success("Password updated successfully"),h(!1)}}),d=i=>{y({body:{current_password:i.current_password,new_password:i.new_password}})};return e.jsx(e.Fragment,{children:e.jsxs(H,{open:s,onOpenChange:b,children:[e.jsx(Z,{asChild:!0,children:m}),e.jsxs(G,{children:[e.jsxs(Y,{children:[e.jsx($,{children:"Change Password"}),e.jsx(W,{children:"Update your account password. Make sure it's strong and secure."}),e.jsx("form",{onSubmit:x(d),children:e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"current_password",children:"Current Password"}),e.jsx(S,{...c("current_password"),id:"current_password",type:"password",placeholder:"Enter your current password",required:!0}),n.current_password&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:n.current_password.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"new_password",children:"New Password"}),e.jsx(S,{...c("new_password"),id:"new_password",type:"password",placeholder:"Enter your new password",required:!0}),n.new_password&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:n.new_password.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Must be at least 8 characters with uppercase, lowercase, and numbers"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"confirm_password",children:"Confirm New Password"}),e.jsx(S,{...c("confirm_password"),id:"confirm_password",type:"password",placeholder:"Confirm your new password",required:!0}),n.confirm_password&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:n.confirm_password.message})]}),n.root&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:n.root.message})]})})})]}),e.jsxs(X,{className:"mt-auto",children:[e.jsxs(p,{disabled:o||l,type:"submit",onClick:x(d),children:[o||l?e.jsx(ee,{className:"animate-spin h-4 w-4 text-white"}):null,o||l?"Updating...":"Update Password"]}),e.jsx(se,{asChild:!0,children:e.jsx(p,{type:"button",variant:"secondary",onClick:()=>{u()},children:"Cancel"})})]})]})]})})},He=function(){var k,z,F,J;const{user:s}=ae(),{viewJob:h}=le(),b=re(),c=(s==null?void 0:s.username)||"system",x=K({...te(),onSuccess:()=>{P.success("Verification email sent. Check your inbox.")},onError:a=>{var r,w;P.error(((w=(r=a.response)==null?void 0:r.data)==null?void 0:w.detail)||"Failed to send verification email. Please try again.")}}),u=()=>{s!=null&&s.email&&x.mutate({body:{email:s.email}})},[t,n]=_.useState({pageIndex:0,pageSize:10}),[o,y]=_.useState([{id:"submitted_on",desc:!0}]),l=ne({query:{skip:t.pageIndex*t.pageSize,limit:t.pageSize,sort_by:(k=o[0])==null?void 0:k.id,sort_order:(z=o[0])!=null&&z.desc?"desc":"asc",user:c}}),{data:d,error:i,isFetching:j}=de({...ie({query:{skip:t.pageIndex*t.pageSize,limit:t.pageSize,sort_by:(F=o[0])==null?void 0:F.id,sort_order:(J=o[0])!=null&&J.desc?"desc":"asc",user:c}}),placeholderData:ce}),g=a=>{h(a,[l])},f=()=>{b.invalidateQueries({queryKey:l,refetchType:"all"})},q=[{id:"viewed",header:"",cell:({row:a})=>{const r=a.original;return e.jsx("div",{className:"flex items-center justify-center w-4",children:r.viewed?e.jsx("div",{className:"h-2 w-2 rounded-full border border-muted-foreground/30",title:"Read"}):e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary",title:"Unread"})})},enableSorting:!1,size:40},{accessorKey:"id",meta:{alias:"Job ID"},header:({column:a})=>e.jsx(N,{column:a,name:"Job ID"}),cell:({cell:a})=>{const r=a.getValue();return e.jsx(xe,{text:r,variant:"primary"})}},{accessorKey:"name",meta:{alias:"Job Name"},header:({column:a})=>e.jsx(N,{column:a,name:"Job Name"}),cell:({cell:a})=>{const r=a.getValue();return e.jsx("span",{className:"text-sm",children:r})}},{accessorKey:"status",meta:{alias:"Status"},header:({column:a})=>e.jsx(N,{column:a,name:"Status"}),cell:({cell:a})=>{const r=a.getValue();return e.jsx(ue,{status:r})}},{accessorKey:"submitted_on",meta:{alias:"Submitted"},header:({column:a})=>e.jsx(N,{column:a,name:"Submitted"}),cell:({cell:a})=>{const r=a.getValue(),w=new Date(r.replace(" ","T")+"Z");return e.jsx("span",{className:"text-sm text-muted-foreground",children:w.toLocaleString(void 0,{timeZoneName:"short"})})}}];if(i)return"An error has occurred: "+i.message;if(!d)return e.jsx(oe,{variant:"ellipsis"});const U=Math.ceil(d.count/t.pageSize),L=e.jsx(e.Fragment,{children:e.jsxs(p,{type:"button",variant:"outline",size:"default",onClick:f,disabled:j,children:[e.jsx(fe,{className:`${j?"animate-spin":""}`}),"Refresh"]})});return e.jsxs("div",{className:"flex flex-col gap-8 pb-8",children:[e.jsx("section",{id:"user-info",className:"scroll-mt-20",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl",children:"Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account information and view your activities."})]}),e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(E,{children:"Account Information"}),e.jsx(A,{children:"Your NGS360 account details"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Full Name"}),e.jsx("p",{className:"text-sm",children:(s==null?void 0:s.full_name)||"Not set"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm",children:s==null?void 0:s.email}),s!=null&&s.is_verified?e.jsxs(R,{children:[e.jsx(V,{asChild:!0,children:e.jsx(je,{className:"h-4 w-4 text-green-600"})}),e.jsx(I,{children:e.jsx("p",{children:"Email verified"})})]}):e.jsxs(R,{children:[e.jsx(V,{asChild:!0,children:e.jsxs(p,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:u,disabled:x.isPending,children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Resend verification email"})]})}),e.jsx(I,{children:e.jsx("p",{children:"Resend verification email"})})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Username"}),e.jsx("p",{className:"text-sm",children:(s==null?void 0:s.username)||"Not set"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Role"}),e.jsx("p",{className:"text-sm capitalize",children:s!=null&&s.is_superuser?"Administrator":"User"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx("p",{className:"text-sm capitalize",children:s!=null&&s.is_active?"Active":"Inactive"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(ye,{trigger:e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Change Password"]})})})]})]})]})}),e.jsx("section",{id:"jobs",className:"scroll-mt-20",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl",children:"Jobs"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage your submitted jobs."})]}),e.jsx(me,{data:d.data,columns:q,pagination:t,onPaginationChange:n,pageCount:U,totalItems:d.count,sorting:o,onSortingChange:y,columnVisibility:{id:!1},tableTools:L,rowClickCallback:a=>g(a.original.id),notFoundComponent:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No jobs found for user: ",c]})})]})}),e.jsx("section",{id:"settings",className:"scroll-mt-20",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account preferences and settings."})]}),e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(E,{children:"Account Settings"}),e.jsx(A,{children:"Update your account preferences"})]}),e.jsx(D,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Settings configuration coming soon..."})})]})]})})]})};export{He as component};
//# sourceMappingURL=_auth.profile.index-DobPnf4N.js.map
