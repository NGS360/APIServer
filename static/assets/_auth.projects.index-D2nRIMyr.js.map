{"version":3,"file":"_auth.projects.index-D2nRIMyr.js","sources":["../../src/routes/_auth.projects.index.tsx?tsr-split=component"],"sourcesContent":["import { keepPreviousData, useQuery } from '@tanstack/react-query'\nimport { Link, createFileRoute, useNavigate } from '@tanstack/react-router'\nimport { useEffect, useState } from 'react'\nimport z from 'zod';\nimport type { ColumnDef, PaginationState, SortingState } from '@tanstack/react-table';\nimport type { Attribute, ProjectPublic } from '@/client';\nimport { searchProjectsOptions } from '@/client/@tanstack/react-query.gen'\nimport { ServerDataTable } from '@/components/data-table/data-table'\nimport { SortableHeader } from '@/components/data-table/sortable-header'\nimport { CopyableText } from '@/components/copyable-text'\nimport { useDebounce } from '@/hooks/use-debounce';\nimport { FullscreenSpinner } from '@/components/spinner';\nimport { highlightMatch } from '@/lib/utils';\n\n// Define the search schema for projects \nconst projectsSearchSchema = z.object({\n  query: z.string().optional().default(\"\"),\n  page: z.number().optional().default(1),\n  per_page: z.number().optional().default(10),\n  sort_by: z.union([\n    z.literal('project_id'),\n    z.literal('name')\n  ]).optional().default('project_id'),\n  sort_order: z.union([\n    z.literal('asc'),\n    z.literal('desc')\n  ]).optional().default('desc')\n})\n\nexport const Route = createFileRoute('/_auth/projects/')({\n  component: RouteComponent,\n  validateSearch: projectsSearchSchema,\n  beforeLoad: ({ search }) => {\n    search\n  },\n})\n\nfunction RouteComponent() {\n\n  // Manage the state of search params\n  const search = Route.useSearch();\n  const navigate = useNavigate();\n\n  // Local table state\n  // Global filter\n  const [globalFilter, setGlobalFilter] = useState<string>(search.query);\n  const debouncedInput: string = useDebounce(globalFilter, 300);\n\n  // Pagination (0-based for Tanstack Table)\n  const [pagination, setPagination] = useState<PaginationState>({\n    pageIndex: search.page - 1,\n    pageSize: search.per_page\n  });\n\n  // Sorting (default: project_id desc)\n  const [sorting, setSorting] = useState<SortingState>([\n    { id: search.sort_by, desc: search.sort_order == 'desc' ? true : false }\n  ]);\n\n  useEffect(() => {\n    navigate({\n      to: '/projects',\n      search: {\n        ...search,\n        query: debouncedInput,\n        page: 1\n      }\n    })\n  }, [debouncedInput])\n\n  useEffect(() => {\n    navigate({\n      to: '/projects',\n      search: {\n        ...search,\n        page: pagination.pageIndex + 1,\n        per_page: pagination.pageSize,\n        sort_by: sorting[0]?.id as 'project_id' | 'name',\n        sort_order: sorting[0]?.desc ? 'desc' : 'asc'\n      },\n      replace: true\n    })\n  }, [pagination, sorting])\n\n  // Query projects\n  const { data, isLoading, error } = useQuery({\n    ...searchProjectsOptions({\n      query: {\n        query: debouncedInput,\n        page: search.page,\n        per_page: search.per_page,\n        sort_by: search.sort_by,\n        sort_order: search.sort_order\n      },\n    }),\n    placeholderData: keepPreviousData // Makes the search feel faster\n  })\n\n  if (isLoading) return <FullscreenSpinner variant='ellipsis' />;\n  if (error) return 'An error has occurred: ' + error.message\n  if (!data) return 'No data was returned.';\n\n  // Define columns\n  const columns: Array<ColumnDef<ProjectPublic>> = [\n    {\n      accessorKey: 'project_id',\n      meta: { alias: 'Project ID', tdClassName: 'align-top' },\n      header: ({ column }) => <SortableHeader column={column} name=\"Project ID\" />,\n      cell: ({ cell }) => {\n        const project_id = cell.getValue() as string\n        return (\n          <CopyableText\n            text={project_id}\n            variant='hoverLink'\n            asChild={true}\n            children={(\n              <Link\n                to='/projects/$project_id'\n                params={{ project_id: project_id }}\n                search={{ \n                  page: 1,\n                  per_page: 5,\n                  sort_by: undefined, \n                  sort_order: undefined \n                }}\n              >\n                {highlightMatch(project_id, debouncedInput)}\n              </Link>\n            )}\n          />\n        )\n      }\n    },\n    {\n      accessorKey: 'name',\n      meta: { alias: 'Project Name', tdClassName: 'align-top' },\n      header: ({ column }) => <SortableHeader column={column} name=\"Project Name\" />,\n      cell: ({ row }) => {\n        const name: string = row.getValue('name')\n        const attributes: Array<Attribute> = row.original.attributes ?? []\n        return (\n          <div className='flex flex-col gap-2 break-words whitespace-normal'>\n            <span className='text-sm'> {/* Use line-clamp-1 here to truncate */}\n              {highlightMatch(name, debouncedInput)}\n            </span>\n            <div className='flex flex-wrap gap-0.5'>\n              {attributes.map((a) => (\n                <div\n                  key={a.key}\n                  className='text-muted-foreground border-1 rounded-full px-2 text-xs'\n                >\n                  <span>\n                    {a.key}: {a.value && a.value.length > 50 ? a.value.slice(0, 50) + \"...\" : a.value}\n                  </span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )\n      }\n    }\n  ]\n\n  return (\n    <div className='animate-fade-in-up'>\n      <h1 className=\"text-2xl\">Projects</h1>\n      <p className=\"text-muted-foreground mb-6\">View all projects in NGS360</p>\n      <ServerDataTable\n        data={data.data}\n        columns={columns}\n        globalFilter={globalFilter}\n        onFilterChange={setGlobalFilter}\n        pagination={pagination}\n        onPaginationChange={setPagination}\n        pageCount={data.total_pages}\n        totalItems={data.total_items}\n        sorting={sorting}\n        onSortingChange={setSorting}\n      />\n    </div>\n  )\n}"],"names":["SplitComponent","search","Route","useSearch","navigate","useNavigate","globalFilter","setGlobalFilter","useState","query","debouncedInput","useDebounce","pagination","setPagination","pageIndex","page","pageSize","per_page","sorting","setSorting","id","sort_by","desc","sort_order","useEffect","to","replace","data","isLoading","error","useQuery","searchProjectsOptions","placeholderData","keepPreviousData","jsx","FullscreenSpinner","message","columns","accessorKey","meta","alias","tdClassName","header","column","SortableHeader","cell","project_id","getValue","CopyableText","Link","undefined","highlightMatch","row","name","attributes","original","jsxs","map","a","key","value","length","slice","ServerDataTable","total_pages","total_items"],"mappings":"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"}