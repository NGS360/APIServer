import{c as L,r as d,j as r,m as q,P as R,l as K,k as P,aI as A,x as G,aU as W,F as X}from"./index-BIirldc1.js";import{P as Q,c as F}from"./scroll-area-BlkD1AVU.js";import{u as J}from"./index-P1ukJAZU.js";import{C as V}from"./check-DV4XU-UY.js";import{u as Y}from"./useQuery-CTa4JkgR.js";import{g as Z,a as B}from"./sortable-header-CBUhMdW4.js";import{D as ee,a as te,b as re,c as se,d as oe,e as ne,f as ae,g as ce}from"./dialog-Dv2OS8bo.js";import{B as ie}from"./button-C2PM_K_5.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],de=L("Undo2",le);var D="Checkbox",[ue,Ee]=q(D),[pe,_]=ue(D);function fe(t){const{__scopeCheckbox:n,checked:a,children:l,defaultChecked:s,disabled:o,form:f,name:x,onCheckedChange:m,required:p,value:k="on",internal_do_not_use_render:h}=t,[b,j]=K({prop:a,defaultProp:s??!1,onChange:m,caller:D}),[C,g]=d.useState(null),[w,u]=d.useState(null),e=d.useRef(!1),c=C?!!f||!!C.closest("form"):!0,i={checked:b,disabled:o,setChecked:j,control:C,setControl:g,name:x,form:f,value:k,hasConsumerStoppedPropagationRef:e,required:p,defaultChecked:v(s)?!1:s,isFormControl:c,bubbleInput:w,setBubbleInput:u};return r.jsx(pe,{scope:n,...i,children:me(h)?h(i):l})}var S="CheckboxTrigger",M=d.forwardRef(({__scopeCheckbox:t,onKeyDown:n,onClick:a,...l},s)=>{const{control:o,value:f,disabled:x,checked:m,required:p,setControl:k,setChecked:h,hasConsumerStoppedPropagationRef:b,isFormControl:j,bubbleInput:C}=_(S,t),g=P(s,k),w=d.useRef(m);return d.useEffect(()=>{const u=o==null?void 0:o.form;if(u){const e=()=>h(w.current);return u.addEventListener("reset",e),()=>u.removeEventListener("reset",e)}},[o,h]),r.jsx(R.button,{type:"button",role:"checkbox","aria-checked":v(m)?"mixed":m,"aria-required":p,"data-state":O(m),"data-disabled":x?"":void 0,disabled:x,value:f,...l,ref:g,onKeyDown:F(n,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:F(a,u=>{h(e=>v(e)?!0:!e),C&&j&&(b.current=u.isPropagationStopped(),b.current||u.stopPropagation())})})});M.displayName=S;var z=d.forwardRef((t,n)=>{const{__scopeCheckbox:a,name:l,checked:s,defaultChecked:o,required:f,disabled:x,value:m,onCheckedChange:p,form:k,...h}=t;return r.jsx(fe,{__scopeCheckbox:a,checked:s,defaultChecked:o,disabled:x,required:f,onCheckedChange:p,name:l,form:k,value:m,internal_do_not_use_render:({isFormControl:b})=>r.jsxs(r.Fragment,{children:[r.jsx(M,{...h,ref:n,__scopeCheckbox:a}),b&&r.jsx(H,{__scopeCheckbox:a})]})})});z.displayName=D;var $="CheckboxIndicator",T=d.forwardRef((t,n)=>{const{__scopeCheckbox:a,forceMount:l,...s}=t,o=_($,a);return r.jsx(Q,{present:l||v(o.checked)||o.checked===!0,children:r.jsx(R.span,{"data-state":O(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:n,style:{pointerEvents:"none",...t.style}})})});T.displayName=$;var U="CheckboxBubbleInput",H=d.forwardRef(({__scopeCheckbox:t,...n},a)=>{const{control:l,hasConsumerStoppedPropagationRef:s,checked:o,defaultChecked:f,required:x,disabled:m,name:p,value:k,form:h,bubbleInput:b,setBubbleInput:j}=_(U,t),C=P(a,j),g=J(o),w=A(l);d.useEffect(()=>{const e=b;if(!e)return;const c=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(c,"checked").set,N=!s.current;if(g!==o&&y){const E=new Event("click",{bubbles:N});e.indeterminate=v(o),y.call(e,v(o)?!1:o),e.dispatchEvent(E)}},[b,g,o,s]);const u=d.useRef(v(o)?!1:o);return r.jsx(R.input,{type:"checkbox","aria-hidden":!0,defaultChecked:f??u.current,required:x,disabled:m,name:p,value:k,form:h,...n,tabIndex:-1,ref:C,style:{...n.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});H.displayName=U;function me(t){return typeof t=="function"}function v(t){return t==="indeterminate"}function O(t){return v(t)?"indeterminate":t?"checked":"unchecked"}function De({className:t,...n}){return r.jsx(z,{"data-slot":"checkbox",className:G("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:r.jsx(T,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:r.jsx(V,{className:"size-3.5 text-current"})})})}function he(t,n=2){if(t===0)return"0 B";const a=1024,l=Math.max(0,n),s=Math.floor(Math.log(t)/Math.log(a)),o=["B","KB","MB","GB","TB"];return parseFloat((t/Math.pow(a,s)).toFixed(l))+" "+o[s]}function xe(t){if(!t||t==="-")return"-";try{const n=new Date(t);return isNaN(n.getTime())?"-":n.toLocaleString()}catch{return"-"}}function I(t,n){return t.replace(n,"").replace(/^\//,"/")}const be=({rootPath:t,directoryPath:n=t,showHeader:a=!1,onDirectoryChange:l})=>{const[s,o]=d.useState(n),[f,x]=d.useState("");d.useEffect(()=>{o(n)},[n]);const m=e=>{o(e),x(""),l==null||l(e)},{data:p,isLoading:k,isError:h,error:b}=Y({...W({query:{uri:s}})}),j=[...(p==null?void 0:p.folders.map(e=>({name:I(e.name,s),fullPath:e.name,date:e.date,dir:!0})))||[],...(p==null?void 0:p.files.map(e=>({name:I(e.name,s),fullPath:e.name,date:e.date,size:e.size,dir:!1})))||[]],C=e=>{const c=s.endsWith("/")?`${s}${e}/`:`${s}/${e}/`;m(c)},g=()=>{const e=s.split("/").filter(Boolean);if(e.length===0)return;const c=t.split("/").filter(Boolean);if(e.length<=c.length)return;const i=e.slice(0,2).join("//"),y=e.slice(2);y.pop();const N=y.join("/"),E=N?[i,N].join("/"):i;m(E.endsWith("/")?E:E+"/")},w=e=>{try{const c=s.endsWith("/")?`${s}${e}`:`${s}/${e}`,i="https://ngsdev.rdcloud.bms.com",N=`${i.endsWith("/")?i.slice(0,-1):i}/api/v1/files/download?path=${encodeURIComponent(c)}`;window.open(N,"_blank")}catch(c){const i=c instanceof Error?c.message:"Failed to download file";alert(`Download error: ${i}`)}},u=[{accessorKey:"name",meta:{alias:"Name"},header:({column:e})=>r.jsx(B,{column:e,name:"Name"}),cell:({cell:e})=>{const{dir:c,name:i}=e.row.original;return r.jsxs("span",{className:"flex gap-2 items-center hover:underline hover:cursor-pointer text-primary",onClick:()=>{c?C(i):w(i)},children:[r.jsx(X,{className:`size-4 ${c?"opacity-100":"opacity-0"}`}),c?i.replace("/",""):i]})}},{accessorKey:"size",meta:{alias:"Size"},header:({column:e})=>r.jsx(B,{column:e,name:"Size"}),cell:({row:e})=>{const{dir:c,size:i}=e.original;return!c&&i!=null?he(i):"-"}},{accessorKey:"date",meta:{alias:"Modified"},header:({column:e})=>r.jsx(B,{column:e,name:"Modified"}),cell:({row:e})=>{const{date:c}=e.original;return xe(c)}}];return h?r.jsxs("div",{className:"p-4 text-center text-destructive",children:["Error: ",b.message||"Failed to load directory."]}):r.jsxs("div",{className:"flex flex-col gap-4",children:[a&&r.jsxs("h2",{className:"text-lg font-medium text-muted-foreground break-words",children:["Files for ",s]}),r.jsx(Z,{data:j,columns:u,renderCustomRowComponent:s!==t,customRowComponent:()=>r.jsxs("span",{className:"flex gap-2 items-center hover:underline hover:cursor-pointer text-primary",onClick:g,children:[r.jsx(de,{className:"size-4"}),"Up a level"]}),isLoading:k,globalFilter:f,onFilterChange:x})]})},Be=({trigger:t,rootPath:n,directoryPath:a=n})=>{const[l,s]=d.useState(!1),[o,f]=d.useState(a);return d.useEffect(()=>{f(a)},[a,n]),r.jsxs(ee,{open:l,onOpenChange:s,children:[r.jsx(te,{asChild:!0,children:t}),r.jsxs(re,{className:"!max-w-4xl",children:[r.jsxs(se,{children:[r.jsxs(oe,{className:"text-muted-foreground max-w-3xl text-wrap break-words whitespace-normal",children:["Files for ",o]}),r.jsx(ne,{className:"hidden",children:"Browse files in bucket"})]}),r.jsx("div",{className:"overflow-auto px-2 pt-2",children:r.jsx(be,{rootPath:n,directoryPath:o,onDirectoryChange:f})}),r.jsx(ae,{children:r.jsx(ce,{asChild:!0,children:r.jsx(ie,{variant:"outline",children:"Close"})})})]})]})};export{De as C,Be as F};
//# sourceMappingURL=file-browser-BAEarV4r.js.map
