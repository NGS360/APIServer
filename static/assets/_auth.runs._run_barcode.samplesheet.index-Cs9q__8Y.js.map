{"version":3,"file":"_auth.runs._run_barcode.samplesheet.index-Cs9q__8Y.js","sources":["../../src/components/samplesheet-not-found-component.tsx","../../src/routes/_auth.runs.$run_barcode.samplesheet.index.tsx?tsr-split=component"],"sourcesContent":["import { useCallback } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getRouteApi } from \"@tanstack/react-router\";\nimport { toast } from \"sonner\";\nimport { FullscreenSpinner } from \"@/components/spinner\";\nimport { FileUpload } from \"@/components/file-upload\"\nimport { getRunSamplesheetQueryKey, postRunSamplesheetMutation } from \"@/client/@tanstack/react-query.gen\";\n\n// Define error component for samplesheet path\nexport const NotFoundComponent = () => {\n\n  // Get route params\n  const routeApi = getRouteApi('/_auth/runs/$run_barcode/samplesheet/')\n  const { run_barcode } = routeApi.useParams()\n\n  const queryClient = useQueryClient();\n\n  // File upload mutation\n  const { mutate, isPending } = useMutation({\n    ...postRunSamplesheetMutation(),\n    onSuccess: () => {\n      // Invalidate the query for the run to refresh samplesheet info\n      queryClient.invalidateQueries({\n        queryKey: getRunSamplesheetQueryKey({\n          path: {\n            run_barcode: run_barcode\n          }\n        })\n      });\n      toast.success(`Samplesheet for run ${run_barcode} uploaded successfully`);\n    },\n    onError: (error) => {\n      console.error(error);\n    }\n  })\n\n  // File upload handler\n  const onDrop = useCallback((\n    acceptedFiles: Array<File>\n  ) => {\n    if (acceptedFiles.length > 0) {\n      mutate({ \n        path: {\n          run_barcode: run_barcode\n        },\n        body: {\n          file: acceptedFiles[0],\n        }\n      });\n    } else {\n      console.error(\"No files accepted\");\n    }\n  }, [])\n\n  // Show loading spinner\n  if (isPending) {\n    return <FullscreenSpinner variant='ellipsis' />\n  }\n\n  return (\n    <FileUpload\n      onDrop={onDrop}\n      displayComponent={(\n        <span className=\"text-primary hover:underline mx-2\">\n          Drag and drop your samplesheet here, or click to select\n        </span>\n      )}\n    />\n  )\n}","import { Link, createFileRoute, getRouteApi, useNavigate } from '@tanstack/react-router'\nimport { createColumnHelper } from '@tanstack/react-table'\nimport { useMutation, useQuery, useQueryClient} from '@tanstack/react-query'\nimport { toast } from 'sonner'\nimport { AxiosError } from 'axios'\nimport { useCallback, useEffect, useState } from 'react'\nimport type { IlluminaSampleSheetResponseModel as RunSamplesheet } from '@/client/types.gen'\nimport { ClientDataTable } from '@/components/data-table/data-table'\nimport { SortableHeader } from '@/components/data-table/sortable-header'\nimport { CopyableText } from '@/components/copyable-text'\nimport { FullscreenDropzone } from '@/components/file-upload'\nimport { NotFoundComponent } from '@/components/samplesheet-not-found-component'\nimport { getRunSamplesheetOptions, getRunSamplesheetQueryKey, postRunSamplesheetMutation } from '@/client/@tanstack/react-query.gen'\nimport { FullscreenSpinner } from '@/components/spinner'\nimport { highlightMatch } from '@/lib/utils'\n\nexport const Route = createFileRoute('/_auth/runs/$run_barcode/samplesheet/')({\n  component: RouteComponent,\n  pendingComponent: () => <FullscreenSpinner variant='ellipsis' />,\n  pendingMs: 200\n})\n\nfunction RouteComponent() {\n  // Get route params\n  const routeApi = getRouteApi('/_auth/runs/$run_barcode/samplesheet/')\n  const { run_barcode } = routeApi.useParams()\n  const navigate = useNavigate()\n  const queryClient = useQueryClient();\n  \n  // Global filter for search\n  const [globalFilter, setGlobalFilter] = useState<string>('')\n  \n  // Use TanStack Query to fetch samplesheet data with custom error handling\n  const { data: runInfo, isLoading, error, isError } = useQuery({\n    ...getRunSamplesheetOptions({\n      path: {\n        run_barcode: run_barcode\n      }\n    }),\n    retry: false, // Don't retry on errors to match loader behavior\n    throwOnError: false, // Handle errors manually\n  })\n\n  // File upload mutation\n  const { mutate, isPending } = useMutation({\n    ...postRunSamplesheetMutation(),\n    onSuccess: () => {\n      // Invalidate the query for the run to refresh samplesheet info\n      queryClient.invalidateQueries({\n        queryKey: getRunSamplesheetQueryKey({\n          path: {\n            run_barcode: run_barcode\n          }\n        })\n      });\n      toast.success(`Samplesheet for run ${run_barcode} uploaded successfully`);\n    },\n    onError: (uploadError) => {\n      console.error(uploadError);\n    }\n  })\n\n  // File upload handler (moved to top to avoid hook order issues)\n  const onDrop = useCallback((acceptedFiles: Array<File>) => {\n    if (acceptedFiles.length > 0) {\n      mutate({\n        path: {\n          run_barcode: run_barcode\n        },\n        body: {\n          file: acceptedFiles[0]\n        }\n      });\n    } else {\n      console.error(\"No files accepted\");\n    }\n  }, [mutate, run_barcode])\n\n  // Handle redirects and alerts for specific error cases\n  useEffect(() => {\n    if (isError) {\n      // Handle AxiosError cases - redirect to /runs with alert\n      if (error instanceof AxiosError) {\n        const msg = \"An error occurred: \" + (error.response?.data?.detail || error.message || \"An unknown error occurred.\")\n        alert(msg)\n        navigate({ to: '/runs' })\n        return\n      }\n      \n      // Handle other non-404/204 errors\n      if ((error as any).status !== 404 && (error as any).status !== 204) {\n        alert('An unknown error occurred.')\n        navigate({ to: '/runs' })\n        return\n      }\n    }\n  }, [isError, error, navigate])\n\n  // Show loading spinner\n  if (isLoading || isPending) {\n    return <FullscreenSpinner variant='ellipsis' />\n  }\n\n  // Show not found component for 204 status or when no data\n  if (isError && ((error as any).status === 204 || (error as any).status === 404)) {\n    return <NotFoundComponent />\n  }\n  \n  // Show not found component if no data but no error (edge case)\n  if (!runInfo && !isError) {\n    return <NotFoundComponent />\n  }\n\n  // If we still have an error at this point, the useEffect should handle it\n  if (isError) {\n    return <FullscreenSpinner variant='ellipsis' /> // Show spinner while redirect happens\n  }\n\n  // Transform header, reads, and settings \n  // into a list of key, value pairs\n  const header = Object.entries(runInfo.Header || {})\n  const reads = Object.entries(runInfo.Reads || {})\n  const settings = Object.entries(runInfo.Settings || {})\n\n  // Define columns for samplesheet\n  type DataRow = NonNullable<RunSamplesheet[\"Data\"]>[number]\n  const columnHelper = createColumnHelper<DataRow>()\n  const columns = runInfo.DataCols?.map((colName: string) =>\n    columnHelper.accessor(colName, {\n      header: ({ column }) => <SortableHeader column={column} name={colName} />,\n      cell: (info) => {\n        const value = info.getValue<string>()\n        if (!value) return null;\n        return colName === \"Sample_Project\" ? (\n          <CopyableText\n            text={value}\n            variant='hoverLink'\n            asChild={true}\n            children={(\n              <Link\n                to='/projects/$project_id'\n                params={{ project_id: value }}\n                preload='intent' // backend should prevent invalid projectIds\n              >\n                {highlightMatch(value, globalFilter)}\n              </Link>\n            )}\n          />\n        ) : (\n          <CopyableText\n            text={value}\n            variant='hover'\n            children={highlightMatch(value, globalFilter)}\n          />\n        )\n      }\n    })\n  )\n\n  return (\n    <div className='animate-fade-in-up'>\n      <FullscreenDropzone \n        subject='a new samplesheet'\n        onDrop={onDrop}\n      >\n        <div className='flex flex-col gap-4'>\n          <div className='flex flex-col gap-4 md:grid md:grid-cols-2 '>\n\n            {/* Samplesheet Header */}\n            <div className='flex flex-col gap-2 md:row-span-2'>\n              <h2 className='text-lg uppercase font-light text-primary'>Header</h2>\n              <table>\n                <tbody>\n                  {header.map(([k, v]) => (\n                    <tr key={k} className='border-t'>\n                      <td className='p-2 align-top'>{k}</td>\n                      <td className='p-2 whitespace-normal break-words break-all'>\n                        {/* Reduce button padding to align items top */}\n                        {v && (\n                          <CopyableText\n                            text={String(v)}\n                            variant='hoverLight'\n                            className='items-start [&>button]:p-[0.25em]'\n                          />\n                        )}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Reads */}\n            <div className='flex flex-col gap-2'>\n              <h2 className='text-lg uppercase font-light text-primary'>Reads</h2>\n              <table>\n                <tbody>\n                  {reads.map(([k, v]) => (\n                    <tr key={k} className='border-t'>\n                      <td className='p-2 align-top'>{String(v)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Settings */}\n            <div className='flex flex-col gap-2'>\n              <h2 className='text-lg uppercase font-light text-primary'>Settings</h2>\n              <table>\n                <tbody>\n                  {settings.map(([k, v]) => (\n                    <tr key={k} className='border-t'>\n                      <td className='p-2 align-top'>{k}</td>\n                      <td className='p-2 whitespace-normal break-words break-all'>\n                        {/* Reduce button padding to align items top */}\n                        {v && (\n                          <CopyableText\n                            text={String(v)}\n                            variant='hoverLight'\n                            className='items-start [&>button]:p-[0.25em]'\n                          />\n                        )}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          {/* Data table */}\n          <div className='flex flex-col gap-2'>\n            <h2 className='text-lg uppercase font-light text-primary'>Data</h2>\n            <div className='mb-15'>\n              <ClientDataTable\n                data={runInfo.Data ?? []}\n                columns={columns ?? []}\n                globalFilter={globalFilter}\n                onFilterChange={setGlobalFilter}\n              />\n            </div>\n          </div>\n        </div>\n      </FullscreenDropzone>\n    </div>\n  )\n}\n"],"names":["NotFoundComponent","routeApi","getRouteApi","run_barcode","queryClient","useQueryClient","mutate","isPending","useMutation","postRunSamplesheetMutation","getRunSamplesheetQueryKey","toast","error","onDrop","useCallback","acceptedFiles","jsx","FullscreenSpinner","FileUpload","SplitComponent","useParams","navigate","useNavigate","globalFilter","setGlobalFilter","useState","data","runInfo","isLoading","isError","useQuery","getRunSamplesheetOptions","path","retry","throwOnError","onSuccess","invalidateQueries","queryKey","success","onError","uploadError","console","length","body","file","useEffect","AxiosError","msg","response","detail","message","alert","to","status","header","Object","entries","Header","reads","Reads","settings","Settings","columnHelper","createColumnHelper","columns","DataCols","map","colName","accessor","column","SortableHeader","cell","info","value","getValue","CopyableText","Link","project_id","highlightMatch","FullscreenDropzone","jsxs","k","v","String","ClientDataTable","Data"],"mappings":"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"}