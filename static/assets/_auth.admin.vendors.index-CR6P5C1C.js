import{c as ee,j as e,x as se,r as _,o as O,a as q,b1 as te,b2 as w,aa as Q,ab as B,ac as M,ad as L,ae as z,af as U,ag as $,L as H,ah as R,b3 as W,s as b,b4 as G,b5 as J,b6 as re,b7 as ae,u as ne,b8 as ie,b9 as de,ba as oe,bb as ce,bc as le,a5 as ue,ak as I,al as T,am as A,a6 as me}from"./index-BIirldc1.js";import{u as K}from"./useQuery-CTa4JkgR.js";import{u as C}from"./useMutation-DLDY0_Jn.js";import{t as k}from"./index-CbXsuHis.js";import{S as xe,a as P}from"./sortable-header-CBUhMdW4.js";import{C as E}from"./copyable-text-hzJJx6rD.js";import{u as X}from"./index.esm-DeL_VMPh.js";import{a as Y,L as h}from"./label-BoUK3cZg.js";import{B as y}from"./button-C2PM_K_5.js";import{I as V}from"./input-DMyO_KgQ.js";import{S as pe}from"./app-setting-card-BnV2TQ9M.js";import{P as he}from"./index-P1ukJAZU.js";import{T as ge}from"./trash-2-BM_fEEzK.js";import"./useBaseQuery-o_MHl0Bk.js";import"./scroll-area-BlkD1AVU.js";import"./popover-Daw9D_6H.js";import"./check-DV4XU-UY.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ve=ee("SquarePen",je);function Z({className:f,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:se("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",f),...t})}const be=O({vendor_id:b().nonempty("Vendor ID is required"),name:b().nonempty("Name is required"),description:b().nonempty("Description is required"),bucket:W([b().startsWith("s3://",{message:"Bucket must start with s3://"}),G(""),J()])}),ye=({trigger:f})=>{const[t,S]=_.useState(!1),x=a=>{a||c(),S(a)},{register:o,handleSubmit:p,reset:c,setError:g,formState:{errors:n,isSubmitting:i}}=X({defaultValues:{vendor_id:"",name:"",description:"",bucket:""},resolver:Y(be)}),l=q(),{mutate:j,isPending:u}=C({...te(),onError:a=>{var N,v;const d=((v=(N=a.response)==null?void 0:N.data.detail)==null?void 0:v.toString())||"An unknown error occurred.";g("root",{message:d})},onSuccess:a=>{c(),l.invalidateQueries({queryKey:w()}),l.invalidateQueries({queryKey:["vendors","all"]}),k.success(`Successfully added vendor ${a.name}`),S(!1)}}),m=a=>{j({body:{vendor_id:a.vendor_id,name:a.name,description:a.description,bucket:a.bucket||null}})};return e.jsx(e.Fragment,{children:e.jsxs(Q,{open:t,onOpenChange:x,children:[e.jsx(B,{asChild:!0,children:f}),e.jsxs(M,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Add Vendor"}),e.jsx(U,{children:"Link an s3 vendor bucket to NGS360 for data ingestion."}),e.jsx("form",{onSubmit:p(m),children:e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"vendor-id",children:"Vendor ID"}),e.jsx(V,{...o("vendor_id"),id:"vendor-id",type:"text",placeholder:"vendor-123",required:!0}),n.vendor_id&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:n.vendor_id.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"name",children:"Name"}),e.jsx(V,{...o("name"),id:"name",type:"text",placeholder:"Vendor Name",required:!0}),n.name&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:n.name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(Z,{...o("description"),id:"description",placeholder:"Description about the vendor",required:!0}),n.description&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:n.description.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"bucket",children:"Bucket (Optional)"}),e.jsx(V,{...o("bucket"),id:"bucket",type:"text",placeholder:"s3://bucket-name"}),n.bucket&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:n.bucket.message})]}),n.root&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:n.root.message})]})})})]}),e.jsxs($,{className:"mt-auto",children:[e.jsxs(y,{disabled:i||u,type:"submit",onClick:p(m),children:[i||u?e.jsx(H,{className:"animate-spin h-4 w-4 text-white"}):null,i||u?"Adding Vendor...":"Add Vendor"]}),e.jsx(R,{asChild:!0,children:e.jsx(y,{type:"button",variant:"secondary",onClick:()=>{c()},children:"Cancel"})})]})]})]})})},fe=O({name:b().nonempty("Name is required"),description:b().nonempty("Description is required"),bucket:W([b().startsWith("s3://",{message:"Bucket must start with s3://"}),G(""),J()])}),Se=({trigger:f,vendor:t})=>{const[S,x]=_.useState(!1),o=d=>{d||g(),x(d)},{register:p,handleSubmit:c,reset:g,setError:n,formState:{errors:i,isSubmitting:l}}=X({defaultValues:{name:t.name,description:t.description,bucket:t.bucket||""},resolver:Y(fe)}),j=q(),{mutate:u,isPending:m}=C({...re(),onError:d=>{var v,s;const N=((s=(v=d.response)==null?void 0:v.data.detail)==null?void 0:s.toString())||"An unknown error occurred.";n("root",{message:N})},onSuccess:d=>{g(),j.invalidateQueries({queryKey:w()}),j.invalidateQueries({queryKey:["vendors","all"]}),k.success(`Successfully updated vendor ${d.name}`),x(!1)}}),a=d=>{u({body:{name:d.name,description:d.description,bucket:d.bucket||null},path:{vendor_id:t.vendor_id}})};return e.jsx(e.Fragment,{children:e.jsxs(Q,{open:S,onOpenChange:o,children:[e.jsx(B,{asChild:!0,children:f}),e.jsxs(M,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Update Vendor"}),e.jsx(U,{children:"Update vendor information and settings."}),e.jsx("form",{onSubmit:c(a),children:e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"vendor-id",children:"Vendor ID"}),e.jsx(V,{id:"vendor-id",type:"text",value:t.vendor_id,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vendor ID cannot be changed"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"name",children:"Name"}),e.jsx(V,{...p("name"),id:"name",type:"text",placeholder:"Vendor Name",required:!0}),i.name&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:i.name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(Z,{...p("description"),id:"description",placeholder:"Description about the vendor",required:!0}),i.description&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:i.description.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"bucket",children:"Bucket (Optional)"}),e.jsx(V,{...p("bucket"),id:"bucket",type:"text",placeholder:"s3://bucket-name"}),i.bucket&&e.jsx("div",{className:"text-xs text-red-500 text-left",children:i.bucket.message})]}),i.root&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:i.root.message})]})})})]}),e.jsxs($,{className:"mt-auto",children:[e.jsxs(y,{disabled:l||m,type:"submit",onClick:c(a),children:[l||m?e.jsx(H,{className:"animate-spin h-4 w-4 text-white"}):null,l||m?"Updating Vendor...":"Update Vendor"]}),e.jsx(R,{asChild:!0,children:e.jsx(y,{type:"button",variant:"secondary",onClick:()=>{g()},children:"Cancel"})})]})]})]})})},Be=function(){const t=ae.useSearch(),S=ne(),x=q(),[o,p]=_.useState({pageIndex:t.page-1,pageSize:t.per_page}),[c,g]=_.useState([{id:t.sort_by,desc:t.sort_order=="desc"}]),n=C({...ie(),onSuccess:()=>{x.invalidateQueries({queryKey:w()}),x.invalidateQueries({queryKey:["vendors","all"]}),k.success("Vendor deleted successfully")},onError:s=>{k.error(`Failed to delete vendor: ${s.message}`)}}),i=s=>{window.confirm(`Are you sure you want to delete vendor "${s.name}"? This action cannot be undone.`)&&n.mutate({path:{vendor_id:s.vendor_id}})};_.useEffect(()=>{var s,r;S({to:"/admin/vendors",search:{...t,page:o.pageIndex+1,per_page:o.pageSize,sort_by:(s=c[0])==null?void 0:s.id,sort_order:(r=c[0])!=null&&r.desc?"desc":"asc"},replace:!0})},[o,c]);const{data:l,error:j}=K({...de({query:{page:t.page,per_page:t.per_page,sort_by:t.sort_by,sort_order:t.sort_order}}),placeholderData:me}),{data:u,error:m}=K(oe({query:{tag_key:"category",tag_value:"vendor settings"}})),{mutate:a,isPending:d}=C({...ce(),onError:s=>{var D,F;const r=((F=(D=s.response)==null?void 0:D.data.detail)==null?void 0:F.toString())||"An unknown error occurred.";k.error(`Failed to update setting: ${r}`)},onSuccess:s=>{x.invalidateQueries({queryKey:le({query:{tag_key:"category",tag_value:"vendor settings"}})}),k.success(`Successfully updated ${s.name}`)}}),N=(s,r)=>{a({path:{key:s},body:{value:r}})};if(j)return"An error has occurred: "+j.message;if(m)return"An error has occurred loading settings: "+m.message;if(!l)return e.jsx(ue,{variant:"ellipsis"});const v=[{accessorKey:"vendor_id",meta:{alias:"Vendor ID"},header:({column:s})=>e.jsx(P,{column:s,name:"Vendor ID"}),cell:({cell:s})=>{const r=s.getValue();return e.jsx(E,{text:r,variant:"primary"})}},{accessorKey:"name",meta:{alias:"Vendor Name"},header:({column:s})=>e.jsx(P,{column:s,name:"Vendor Name"}),cell:({cell:s})=>{const r=s.getValue();return e.jsx("span",{className:"text-sm",children:r})}},{accessorKey:"description",meta:{alias:"Description"},header:"Description",cell:({cell:s})=>{const r=s.getValue();return e.jsx("span",{className:"text-sm text-muted-foreground",children:r})}},{accessorKey:"bucket",meta:{alias:"Bucket"},header:"Bucket",cell:({cell:s})=>{const r=s.getValue();return r?e.jsx(E,{text:r,variant:"hoverLight"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"â€”"})}},{id:"actions",header:"Actions",cell:({row:s})=>{const r=s.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs(I,{children:[e.jsx(Se,{vendor:r,trigger:e.jsx(T,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"icon",children:[e.jsx(ve,{}),e.jsx("span",{className:"sr-only",children:"Edit"})]})})}),e.jsx(A,{children:e.jsx("p",{children:"Edit vendor"})})]}),e.jsxs(I,{children:[e.jsx(T,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>i(r),disabled:n.isPending,children:[e.jsx(ge,{}),e.jsx("span",{className:"sr-only",children:"Delete"})]})}),e.jsx(A,{children:e.jsx("p",{children:"Delete vendor"})})]})]})}}];return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl",children:"Vendors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor information and settings here."})]}),e.jsx(ye,{trigger:e.jsxs(y,{variant:"primary2",className:"w-full md:w-auto",children:[e.jsx(he,{className:"h-4 w-4"}),"Add Vendor"]})})]}),e.jsx(xe,{data:l.data,columns:v,pagination:o,onPaginationChange:p,pageCount:l.total_pages,totalItems:l.total_items,sorting:c,onSortingChange:g}),e.jsx("hr",{}),u&&u.length>0&&e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx("div",{className:"grid gap-4",children:u.map(s=>e.jsx(pe,{setting:s,isPending:d,onSave:N},s.key))})})]})};export{Be as component};
//# sourceMappingURL=_auth.admin.vendors.index-CR6P5C1C.js.map
