import{c as y,an as L,j as e,L as $,s as _,ao as V,ap as Q,aq as z,o as H,x as J,u as W,ar as A,as as P,a as U,r as N,at as K,au as G,a5 as Z,ak as F,al as M,am as q,O as X,av as Y,aw as ee}from"./index-BIirldc1.js";import{u as se}from"./useQuery-CTa4JkgR.js";import{u as B}from"./useMutation-DLDY0_Jn.js";import{t as p}from"./index-CbXsuHis.js";import{a as ae,L as E}from"./label-BoUK3cZg.js";import{u as re}from"./index.esm-DeL_VMPh.js";import{u as oe,a as te}from"./use-job-queries-C1A_Ye7H.js";import{B as l}from"./button-C2PM_K_5.js";import{C as ne,F as le}from"./file-browser-BAEarV4r.js";import{D as ie,b as ce,c as de,d as me,e as he,f as xe,g as ue}from"./dialog-Dv2OS8bo.js";import{I as O}from"./input-DMyO_KgQ.js";import{b as pe,c as fe,d as je,e as ge,f as be,C as ye}from"./sortable-header-CBUhMdW4.js";import{S as we}from"./separator-ClsyK3GL.js";import{D as ve,a as ke,b as Ce,c as Ne}from"./index-P1ukJAZU.js";import{C as Se}from"./circle-play-u-Uw65K8.js";import"./useBaseQuery-o_MHl0Bk.js";import"./scroll-area-BlkD1AVU.js";import"./check-DV4XU-UY.js";import"./popover-Daw9D_6H.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M7 16h8",key:"srdodz"}],["path",{d:"M7 11h12",key:"127s9w"}],["path",{d:"M7 6h3",key:"w9rmul"}]],_e=y("ChartBar",De);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],Me=y("FileSpreadsheet",Fe);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Re=y("FolderOpen",qe);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Oe=y("RotateCw",Ee);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],$e=y("Upload",Te),Be=({toolConfig:n,runBarcode:c,isOpen:t,onOpenChange:f})=>{const{viewJob:m}=oe(),{invalidateJobQueries:w}=te(),{mutate:h,isPending:j}=B({...L(),onError:s=>{console.error("Error submitting workflow execution:",s),p.error("Failed to execute workflow")},onSuccess:s=>{w(),p.success("Demux job submitted successfully",{description:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",className:"flex-1",onClick:()=>m(s.id),children:"View Job"}),e.jsx(l,{size:"sm",variant:"secondary",className:"flex-1",onClick:()=>p.dismiss(),children:"Dismiss"})]})})}),b(!1),u(d())}}),S=(()=>{const s={};return n.inputs.forEach(a=>{let o;switch(a.type){case"String":o=_(),a.required&&(o=o.min(1,`${a.name} is required`));break;case"Integer":o=z().int(`${a.name} must be an integer`),a.required&&(o=o.refine(x=>x!=null,{message:`${a.name} is required`}));break;case"Boolean":o=Q();break;case"Enum":if(a.options&&a.options.length>0){const[x,...i]=a.options;o=V([x,...i]),a.required&&(o=o.refine(I=>I!=="",`${a.name} is required`))}else o=_();break;default:o=_()}a.required||(o=o.optional()),s[a.name]=o}),H(s)})(),d=()=>{const s={};return n.inputs.forEach(a=>{if(a.default!==null&&a.default!==void 0)s[a.name]=a.default;else switch(a.type){case"Boolean":s[a.name]=!1;break;case"String":s[a.name]="";break;case"Enum":break;case"Integer":s[a.name]=void 0;break}}),s},{register:v,handleSubmit:D,reset:u,setValue:g,watch:k,formState:{errors:C}}=re({defaultValues:d(),resolver:ae(S)}),b=s=>{s||u(d()),f(s)},r=s=>{h({body:{workflow_id:n.workflow_id,run_barcode:c,inputs:s}})};return e.jsx(ie,{open:t,onOpenChange:b,children:e.jsxs(ce,{className:"sm:max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(me,{children:n.workflow_name}),e.jsx(he,{children:n.workflow_description})]}),e.jsxs("form",{onSubmit:D(r),children:[e.jsxs("div",{className:"grid gap-6 py-4",children:[n.inputs.map(s=>{var a,o,x;return e.jsxs("div",{className:"grid gap-2",children:[s.type!=="Boolean"&&e.jsxs(E,{htmlFor:s.desc,children:[s.desc,s.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),s.type==="String"&&e.jsx(O,{...v(s.name),id:s.name,type:"text",placeholder:((a=s.default)==null?void 0:a.toString())||""}),s.type==="Integer"&&e.jsx(O,{...v(s.name),id:s.name,type:"number",step:"1",placeholder:((o=s.default)==null?void 0:o.toString())||""}),s.type==="Boolean"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{id:s.name,checked:k(s.name),onCheckedChange:i=>{g(s.name,i)}}),e.jsxs(E,{htmlFor:s.name,className:"!mt-0",children:[s.desc,s.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})]}),s.type==="Enum"&&s.options&&e.jsxs(pe,{value:k(s.name),onValueChange:i=>g(s.name,i),children:[e.jsx(fe,{id:s.name,children:e.jsx(je,{placeholder:"Select an option..."})}),e.jsx(ge,{children:s.options.map(i=>e.jsx(be,{value:i,children:i},i))})]}),C[s.name]&&e.jsx("div",{className:"text-xs text-red-500 text-left break-all",children:(x=C[s.name])==null?void 0:x.message})]},s.name)}),n.help&&e.jsx("div",{className:"rounded-md bg-muted p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:n.help})})]}),e.jsxs(xe,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{u(d())},children:"Reset"}),e.jsx(ue,{asChild:!0,children:e.jsx(l,{type:"button",variant:"secondary",onClick:()=>{u(d())},children:"Cancel"})}),e.jsx(l,{disabled:j,type:"submit",children:j?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"animate-spin h-4 w-4 mr-2"}),"Executing..."]}):"Execute Workflow"})]})]})]})})},Ie=({children:n,className:c})=>e.jsx("nav",{className:J("w-full flex flex-col gap-2 md:flex-row md:gap-0 md:border-b-2 md:border-muted",c),children:n}),T=({to:n,params:c,replace:t=!1,children:f})=>{const m=W(),h=!!A()({to:n,params:c});return e.jsx("div",{"data-active":h,className:`
        border-2
        rounded-md
        data-[active=true]:border-primary
        data-[active=true]:text-primary

        md:pb-1
        md:px-2
        md:rounded-none
        md:border-t-0
        md:border-x-0
        md:border-b-2
        md:border-transparent
        md:data-[active=true]:border-primary
      `,children:e.jsx(l,{variant:"ghost",className:"w-full","aria-current":h?"page":void 0,onClick:()=>m({to:n,params:c,replace:t}),children:f})})},os=function(){var b;const c=P("/_auth/runs/$run_barcode"),{run:t}=c.useLoaderData(),f=U(),m=se({queryKey:["listDemultiplexWorkflows"],queryFn:async()=>(await ee({throwOnError:!0})).data}),[w,h]=N.useState(!1),[j,R]=N.useState(null),[S,d]=N.useState(!1),v=async r=>{try{const s=await Y({path:{workflow_id:r},query:{run_barcode:t.barcode},throwOnError:!0});R(s.data),d(!0)}catch(s){console.error("Error fetching workflow config:",s),p.error(`Failed to fetch config for workflow: ${r}`)}h(!1)},{mutate:D,isPending:u}=B({...K(),onSuccess:()=>{f.invalidateQueries({queryKey:G({path:{run_barcode:t.barcode}})}),p.success(`Samplesheet for run ${t.barcode} uploaded successfully`)},onError:r=>{console.error(r),p.error("Failed to upload file")}}),g=N.useRef(null),k=()=>{var r;(r=g.current)==null||r.click()},C=r=>{if(r.target.files&&r.target.files.length){const s=r.target.files[0];console.log(s),D({path:{run_barcode:t.barcode},body:{file:s}}),r.target.value=""}};return u?e.jsx(Z,{variant:"ellipsis"}):e.jsxs(e.Fragment,{children:[j&&e.jsx(Be,{toolConfig:j,runBarcode:t.barcode,isOpen:S,onOpenChange:d}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h1",{className:"text-3xl font-extralight overflow-x-clip overflow-ellipsis",children:t.barcode}),e.jsx("p",{className:"text-muted-foreground",children:t.experiment_name}),e.jsx("div",{className:"flex gap-4",children:e.jsxs(Ie,{className:"justify-between",children:[e.jsxs("div",{className:"flex gap-2 flex-col md:flex-row md:items-center",children:[e.jsxs(T,{to:"/runs/$run_barcode/samplesheet",params:{run_barcode:t.barcode},children:[e.jsx(Me,{}),e.jsx("span",{children:"Samplesheet"})]}),e.jsxs(T,{to:"/runs/$run_barcode/indexqc",params:{run_barcode:t.barcode},children:[e.jsx(_e,{}),e.jsx("span",{children:"IndexQC"})]})]}),e.jsxs("div",{className:"md:flex md:gap-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{children:["Status: ",t.status]}),e.jsx("div",{className:"h-4",children:e.jsx(we,{orientation:"vertical"})}),e.jsxs("div",{className:"flex gap-0 items-center",children:[e.jsxs(F,{children:[e.jsx(M,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>{console.log("Re-sync run")},children:e.jsx(Oe,{})})}),e.jsx(q,{children:"Re-sync Run"})]}),e.jsxs(F,{children:[e.jsx(le,{trigger:e.jsx(M,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",children:e.jsx(Re,{})})}),rootPath:`${t.run_folder_uri}/`}),e.jsx(q,{children:"Browse Run Folder"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"samplesheetFileUpload",type:"file",ref:g,className:"hidden",onChange:C}),e.jsxs(F,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(l,{className:"flex-1 min-w-0 md:flex-none md:w-auto",variant:"primary2",onClick:k,children:[e.jsx($e,{})," Upload file"]})}),e.jsx(q,{className:"max-w-45 text-wrap text-center",children:"Drop file on the page or click here to upload a new samplesheet"})]}),e.jsxs(ve,{open:w,onOpenChange:h,children:[e.jsx(ke,{asChild:!0,children:e.jsx(l,{className:"flex-1 min-w-0 md:flex-none md:w-auto",variant:"primary2",disabled:m.isLoading,children:m.isLoading?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"animate-spin"})," Getting tools..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{})," Demultiplex Run ",e.jsx(ye,{className:"ml-1"})]})})}),e.jsx(Ce,{align:"end",children:(b=m.data)==null?void 0:b.map(r=>e.jsx(Ne,{onClick:()=>v(r),children:r},r))})]})]})]})]})}),e.jsx(X,{})]})]})};export{os as component};
//# sourceMappingURL=_auth.runs._run_barcode.route-Cj5L8_L6.js.map
