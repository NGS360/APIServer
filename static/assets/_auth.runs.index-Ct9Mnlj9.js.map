{"version":3,"file":"_auth.runs.index-Ct9Mnlj9.js","sources":["../../src/routes/_auth.runs.index.tsx?tsr-split=component"],"sourcesContent":["import { keepPreviousData, useQuery } from '@tanstack/react-query'\nimport { Link, createFileRoute, useNavigate } from '@tanstack/react-router'\nimport { useEffect, useState } from 'react'\nimport z from 'zod';\nimport type { ColumnDef, PaginationState, SortingState } from '@tanstack/react-table';\nimport type { SequencingRunPublic } from '@/client';\nimport { searchRunsOptions } from '@/client/@tanstack/react-query.gen'\nimport { ServerDataTable } from '@/components/data-table/data-table'\nimport { SortableHeader } from '@/components/data-table/sortable-header'\nimport { CopyableText } from '@/components/copyable-text'\nimport { useDebounce } from '@/hooks/use-debounce';\nimport { FullscreenSpinner } from '@/components/spinner';\nimport { highlightMatch } from '@/lib/utils';\n\n// Define the search schema for projects \nconst runsSearchSchema = z.object({\n  query: z.string().optional().default(\"\"),\n  page: z.number().optional().default(1),\n  per_page: z.number().optional().default(10),\n  sort_by: z.union([\n    z.literal('barcode'),\n    z.literal('experiment_name')\n  ]).optional().default('barcode'),\n  sort_order: z.union([\n    z.literal('asc'),\n    z.literal('desc')\n  ]).optional().default('desc')\n})\n\nexport const Route = createFileRoute('/_auth/runs/')({\n  component: RouteComponent,\n  validateSearch: runsSearchSchema,\n  beforeLoad: ({ search }) => {\n    search\n  },\n})\n\nfunction RouteComponent() {\n\n  // Manage the state of search params\n  const search = Route.useSearch();\n  const navigate = useNavigate();\n\n  // Local table state\n  // Global filter\n  const [globalFilter, setGlobalFilter] = useState<string>(search.query);\n  const debouncedInput: string = useDebounce(globalFilter, 300);\n\n  // Pagination (0-based for Tanstack Table)\n  const [pagination, setPagination] = useState<PaginationState>({\n    pageIndex: search.page - 1,\n    pageSize: search.per_page\n  });\n\n  // Sorting (default: barcode desc)\n  const [sorting, setSorting] = useState<SortingState>([\n    { id: search.sort_by, desc: search.sort_order == 'desc' ? true : false }\n  ]);\n\n  useEffect(() => {\n    navigate({\n      to: '/runs',\n      search: {\n        ...search,\n        query: debouncedInput,\n        page: 1\n      }\n    })\n\n  }, [debouncedInput])\n\n  useEffect(() => {\n    navigate({\n      to: '/runs',\n      search: {\n        ...search,\n        page: pagination.pageIndex + 1,\n        per_page: pagination.pageSize,\n        sort_by: sorting[0]?.id as 'barcode' | 'experiment_name',\n        sort_order: sorting[0]?.desc ? 'desc' : 'asc'\n      },\n      replace: true\n    })\n  }, [pagination, sorting])\n\n  // Query runs\n  const { data, isLoading, error } = useQuery({\n    ...searchRunsOptions({\n      query: {\n        query: debouncedInput,\n        page: search.page,\n        per_page: search.per_page,\n        sort_by: search.sort_by,\n        sort_order: search.sort_order\n      },\n    }),\n    placeholderData: keepPreviousData // Makes the search feel faster\n  })\n\n  if (isLoading) return <FullscreenSpinner variant='ellipsis' />;\n  if (error) return 'An error has occurred: ' + error.message\n  if (!data) return 'No data was returned.';\n\n  // Define columns\n  const columns: Array<ColumnDef<SequencingRunPublic>> = [\n    {\n      accessorKey: 'barcode',\n      meta: { alias: \"Experiment\" },\n      header: ({ column }) => <SortableHeader column={column} name=\"Experiment\" />,\n      cell: ({ cell, row }) => {\n        const barcode = cell.getValue() as string\n        const status = row.getValue('status')\n        return status === \"Ready\" ? (\n            <CopyableText\n              text={barcode}\n              variant='hoverLink'\n              asChild={true}\n              children={(\n                <Link\n                  to='/runs/$run_barcode'\n                  params={{ run_barcode: barcode }}\n                  preload={false}\n                >\n                  {highlightMatch(barcode, debouncedInput)}\n                </Link>\n              )}\n            />\n          ) : (\n            <CopyableText\n              text={barcode}\n              variant='hoverLight'\n              children={highlightMatch(barcode, debouncedInput)}\n            />\n          )\n      }\n    },\n    {\n      accessorKey: 'machine_id',\n      meta: { alias: \"Instrument\" },\n      header: \"Instrument\",\n      cell: ({ cell }) => {\n        const value = cell.getValue() as string\n        return (\n          <CopyableText\n            text={value}\n            variant='hover'\n            children={highlightMatch(value, debouncedInput)}\n          />\n        )\n      }\n    },\n    {\n      accessorKey: 'flowcell_id',\n      meta: { alias: \"Flowcell\" },\n      header: \"Flowcell\",\n      cell: ({ cell }) => {\n        const value = cell.getValue() as string\n        return (\n          <CopyableText\n            text={value}\n            variant='hover'\n            children={highlightMatch(value, debouncedInput)}\n          />\n        )\n      }\n    },\n    {\n      accessorKey: 'run_date',\n      meta: { alias: \"Run Date\" },\n      header: \"Run Date\"\n    },\n    {\n      accessorKey: 'run_folder_uri',\n      meta: { alias: \"Run Folder\" },\n      header: \"Run Folder\",\n      cell: ({ cell }) => {\n        const value = cell.getValue() as string\n        return (\n          <CopyableText\n            text={value}\n            variant='hover'\n            children={highlightMatch(value, debouncedInput)}\n          />\n        )\n      }\n    },\n    {\n      accessorKey: 'status',\n      meta: { alias: \"Status\" },\n      header: \"Status\"\n    }\n  ]\n\n  return (\n    <div className='animate-fade-in-up'>\n      <h1 className=\"text-2xl\">Illumina Runs</h1>\n      <p className=\"text-muted-foreground mb-6\">View all illumina runs in NGS360</p>\n      <ServerDataTable\n        data={data.data}\n        columns={columns}\n        columnVisibility={{ run_folder_uri: false}}\n        globalFilter={globalFilter}\n        onFilterChange={setGlobalFilter}\n        pagination={pagination}\n        onPaginationChange={setPagination}\n        pageCount={data.total_pages}\n        totalItems={data.total_items}\n        sorting={sorting}\n        onSortingChange={setSorting}\n      />\n    </div>\n  )\n}"],"names":["SplitComponent","search","Route","useSearch","navigate","useNavigate","globalFilter","setGlobalFilter","useState","query","debouncedInput","useDebounce","pagination","setPagination","pageIndex","page","pageSize","per_page","sorting","setSorting","id","sort_by","desc","sort_order","useEffect","to","replace","data","isLoading","error","useQuery","searchRunsOptions","placeholderData","keepPreviousData","jsx","FullscreenSpinner","message","columns","accessorKey","meta","alias","header","column","SortableHeader","cell","row","barcode","getValue","CopyableText","Link","run_barcode","highlightMatch","value","jsxs","ServerDataTable","run_folder_uri","total_pages","total_items"],"mappings":"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"}